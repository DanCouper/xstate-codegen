import {
  EventObject,
  Typestate,
} from 'xstate';
import {
  StateWithMatches,
  InterpreterWithMatches,
  RegisteredMachinesMap,
  RegisteredMachine,
} from '@xstate/compiled';

declare module '@xstate/compiled/react' {
  export function useMachine<
    TContext,
    TSchema,
    TEvent extends EventObject,
    TTypestate extends Typestate<TContext>,
    Id extends keyof RegisteredMachinesMap<TContext, TEvent, TTypestate>
  >(
    machine: Extract<RegisteredMachine<TContext, TEvent, TTypestate>, { id: Id }>,
    options: Extract<
      RegisteredMachine<TContext, TEvent, TTypestate>,
      { id: Id }
    >['_options'],
  ): [
    StateWithMatches<
      TContext,
      TEvent,
      Id
    >,
    InterpreterWithMatches<TContext, TSchema, TEvent, Id>['send'],
    InterpreterWithMatches<TContext, TSchema, TEvent, Id>,
  ];

  export function useService<
    TContext,
    TSchema,
    TEvent extends EventObject,
    TTypestate extends Typestate<TContext>,
    Id extends keyof RegisteredMachinesMap<TContext, TEvent, TTypestate>
  >(
    service: InterpreterWithMatches<TContext, TSchema, TEvent, Id>
  ): [
    StateWithMatches<
      TContext,
      TEvent,
      Id
    >,
    InterpreterWithMatches<TContext, TSchema, TEvent, Id>['send'],
    InterpreterWithMatches<TContext, TSchema, TEvent, Id>,
  ];
}